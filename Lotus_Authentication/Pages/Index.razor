@page "/"

<PageTitle>Index</PageTitle>

<div style="width: fit-content;">
    <PictureCard
        ImgSrc="@RandomJokeImg"
        Description="@RandomJoke"
        Title="Chuck Norris"
        Variant="PictureCardVariant.Medium"
    >

    </PictureCard>
    <LotusButton
        OnClickCallBack="@GetRandomJoke"
        Class="col-12"
    >
    Get a random Chuck Norris joke
    </LotusButton>
    
    <div style="display: flex; flex-direction: row; width: 100%;">
    @foreach(string imgSource in ImageGallery)
    {
        <div>
            <PictureCard
                ImgSrc="@imgSource"
                Description="Static description"
                Title="Some picture"
                Variant="PictureCardVariant.Medium"
            >
            </PictureCard>
        </div>
    }
    
    </div>
</div>

@code
{
    protected string RandomJokeImg { get; set; }
    protected string RandomJoke { get; set; } = "No joke right naow :(";
    protected HttpClient Client = new();

    List<string> ImageGallery = new();

    protected override void OnInitialized()
    {
        FetchImageGallery();
    }

    protected void FetchImageGallery()
    {
        string rootPath = "wwwroot";
        ImageGallery = Directory.GetFiles($"{rootPath}/GalleryImages/", "*.jpg").Select(s => s.Substring(rootPath.Length)).ToList();
    }
    
    class ChuckJokeModel
    {
        public string icon_url { get; set; }
        public string value { get; set; }
    }

    protected async Task GetRandomJoke()
    {
        string endpoint = "https://api.chucknorris.io/jokes/random";
        ChuckJokeModel response = await Client.GetFromJsonAsync<ChuckJokeModel>(endpoint);

        RandomJokeImg = response.icon_url;
        RandomJoke = response.value;
    }
}